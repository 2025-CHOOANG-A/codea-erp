<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.codea.item.item_mapper">

<!-- insert -->
<!-- 제품등록 -->
 <!-- 1. ITEM 테이블 INSERT -->
  <insert id="insert_item" parameterType="kr.co.codea.item.itemDTO">
  INSERT INTO ITEM (
      ITEM_CODE, ITEM_NAME, ITEM_TYPE,
      ITEM_CAT_L, ITEM_CAT_S, UNIT_CODE,
      SPEC, REMARK, LEAD_TIME, BP_CODE, PRICE
    ) VALUES (
      #{itemCode}, #{itemName}, #{itemType},
      #{itemCatL}, #{itemCatS}, #{unitCode},
      #{spec}, #{reMark}, #{leadTime}, #{bpCode}, #{price}
    )
</insert>

<!-- 제품목록 , 검색 조회  
 resultType="kr.co.codea.item.item_list_DTO"
   cc.CODE AS UNIT_NAME => 단위 EA 조회하기 
-->
<select id="item_select"  parameterType="String"  resultMap="itemListResultMap">   
SELECT 
  A.ITEM_ID,
  A.ITEM_CODE,
  A.ITEM_TYPE,
  A.ITEM_NAME,
  A.ITEM_CAT_L,
  A.ITEM_CAT_S,
  A.SPEC,
  A.UNIT_CODE,
  CC.CODE AS UNIT_CODE_VALUE, 
  A.PRICE,
  A.BP_CODE,
  P.BP_NAME,
  P.TEL,  
  A.REMARK
FROM ITEM A
LEFT JOIN BUSINESS_PARTNER P 
  ON A.BP_CODE = P.BP_CODE
LEFT JOIN COMMON_CODE CC 
  ON A.UNIT_CODE = CC.CODE_ID 
  AND CC.CODE_TYPE = 'UNIT_CODE'
  AND P.BP_TYPE = '고객사' 
  <where>
    <if test="itemType != null and itemType != ''">
      A.ITEM_TYPE = #{itemType}
    </if>
    <if test="keyword != null and keyword != ''">
      AND (
        A.ITEM_NAME LIKE CONCAT('%', #{keyword}, '%')
        OR A.ITEM_CODE LIKE CONCAT('%', #{keyword}, '%')
      )
    </if>
  </where>
</select>
    
<!-- 제품 상세 정보 -->
<select id="item_detail" parameterType="int" resultType="kr.co.codea.item.itemDTO">
SELECT 
  A.ITEM_ID,
  A.ITEM_CODE,
  A.ITEM_TYPE,
  A.ITEM_NAME,
  A.ITEM_CAT_L,
  A.ITEM_CAT_S,
  A.SPEC,
  A.UNIT_CODE,
  CC.CODE AS UNIT_CODE_VALUE, 
  A.PRICE,
  A.BP_CODE,
  P.BP_NAME,
  P.TEL,                     
  A.REMARK
FROM ITEM A
LEFT JOIN BUSINESS_PARTNER P 
  ON A.BP_CODE = P.BP_CODE
LEFT JOIN COMMON_CODE CC 
  ON A.UNIT_CODE = CC.CODE_ID 
  AND CC.CODE_TYPE = 'UNIT_CODE'
WHERE A.ITEM_TYPE = '완제품'        
  AND P.BP_TYPE = '고객사'   
</select>

<!-- 거래처 조회(비즈니스 파트너)-->
<select id="bp_select"  parameterType="String"  resultMap="itemListResultMap">
  SELECT 
    BP_NAME, 
    BP_CODE,
    TEL
  FROM BUSINESS_PARTNER
  WHERE BP_TYPE = '고객사'
</select>

<!-- 대분류 소분류 칼럼(ITEM-CATEGORY)  -->
<select id="item_cg_select"  parameterType="String"  resultMap="itemListResultMap">
SELECT 
  i.ITEM_CODE,
  i.ITEM_NAME,
  catL.CATEGORY_NAME AS ITEM_CAT_L_NAME,
  catS.CATEGORY_NAME AS ITEM_CAT_S_NAME
FROM ITEM i
LEFT JOIN ITEM_CATEGORY catL ON i.ITEM_CAT_L = catL.CATEGORY_ID
LEFT JOIN ITEM_CATEGORY catS ON .ITEM_CAT_S = catS.CATEGORY_ID
</select>

<!-- 대분류만 뽑기 -->
<select id="selectCatL" resultType="itemDTO">
  SELECT CATEGORY_ID, CATEGORY_NAME
  FROM ITEM_CATEGORY
  WHERE CATEGORY_LEVEL = 1
</select>

<!-- 소분류만 뽑기 -->
<select id="selectCatS" resultType="itemDTO">
  SELECT CATEGORY_ID, CATEGORY_NAME, PARENT_ID
  FROM ITEM_CATEGORY
  WHERE CATEGORY_LEVEL = 2
</select>

<!-- 단위뽑기
  c.CODE_DESC AS UNIT_NAME =>별명 잡음(단위이름)
 -->
<select  id="unitcode_list" resultType="itemDTO">
  SELECT CODE_ID, CODE
  FROM COMMON_CODE
  WHERE CODE_TYPE = 'UNIT_CODE'
</select>

<!-- resultMap -->
<resultMap id="itemListResultMap" type="kr.co.codea.item.itemDTO">
    <result property="itemCode" column="ITEM_CODE"/>
    <result property="itemName" column="ITEM_NAME"/>
    <result property="itemCatL" column="ITEM_CAT_L"/>
    <result property="itemCatS" column="ITEM_CAT_S"/>
    <result property="spec" column="SPEC"/>
    <result property="reMark" column="REMARK"/>
    <result property="price" column="PRICE"/>
    <result property="unitCode" column="UNIT_CODE"/>
    <result property="Code" column="CODE"/>
    
    <result property="bpCode" column="BP_CODE"/>
    <result property="bpName" column="BP_NAME"/>
    <result property="Tel" column="TEL"/>
    
    <result property="itemCatLName" column="ITEM_CAT_L_NAME"/>
    <result property="itemCatSName" column="ITEM_CAT_S_NAME"/>
    
    <result property="categoryId" column="CATEGORY_ID"/>
     
    <result property="codeId" column="CODE_ID"/>
    <result property="codeDesc" column="CODE_DESC"/>
   
    <result property="itemId" column="ITEM_ID"/>
    <result property="itemType" column="ITEM_TYPE"/>
    <result property="leadTime" column="LEAD_TIME"/>
    <result property="createdAt" column="CREATED_AT"/>
    <result property="unitName" column="UNIT_NAME"/>
    <result property="unitcodeValue" column="UNIT_CODE_VALUE"/>
</resultMap>
</mapper>