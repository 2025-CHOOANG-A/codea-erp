<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>발주목록</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
body {
	font-family: 'Segoe UI', sans-serif;
	overflow-x: hidden;
}

.sidebar {
	position: fixed;
	top: 0;
	left: -250px;
	width: 250px;
	height: 100%;
	background-color: #343a40;
	color: white;
	overflow-y: auto;
	padding: 1rem;
	z-index: 1050;
	transition: left 0.3s ease;
}

.sidebar.active {
	left: 0;
}

.sidebar h5, .sidebar .section-title {
	font-size: 14px;
	color: #adb5bd;
	margin-top: 1.5rem;
	margin-bottom: 0.5rem;
}

.sidebar a {
	display: block;
	color: white;
	text-decoration: none;
	padding: 4px 0;
	font-size: 15px;
}

.sidebar a:hover {
	text-decoration: underline;
}

.menu-header {
	font-weight: bold;
	font-size: 18px;
	margin-bottom: 1rem;
}

.top-bar {
	height: 60px;
	background-color: white;
	padding: 0 1rem;
	display: flex;
	align-items: center;
	justify-content: space-between;
	color: black;
	border-bottom: 1px solid #e9ecef;
}

.menu-icon {
	font-size: 24px;
	cursor: pointer;
	color: black;
	background: none;
	border: none;
}

.close-icon {
	font-size: 20px;
	color: white;
	background: none;
	border: none;
	position: absolute;
	top: 10px;
	right: 10px;
	cursor: pointer;
}

.main-content {
	padding: 2rem;
	transition: margin-left 0.3s ease;
}

.main-content.shifted {
	margin-left: 250px;
}

.table th, .table td {
	vertical-align: middle;
	text-align: center;
}

.table th.text-start, .table td.text-start {
	text-align: left;
}

.table th.text-end, .table td.text-end {
	text-align: right;
}

.purchase-code-link {
	color: #0d6efd;
	text-decoration: none;
	font-weight: 500;
	cursor: pointer;
}

.purchase-code-link:hover {
	text-decoration: underline;
}

.btn-group-bottom {
	margin-top: 1rem;
	text-align: right;
}
</style>
</head>
<body>
	<div class="sidebar" id="sidebar">
		<button class="close-icon" onclick="toggleSidebar()">&times;</button>
		<div class="menu-header">메뉴</div>
		<div class="section-title">기준정보관리</div>
		<a href="#">사업장관리</a> <a href="#">거래처관리</a> <a href="#">창고관리</a> <a
			href="#">제품관리</a> <a href="#">품목관리</a> <a href="#">사원관리</a> <a
			href="#">공지사항</a>
		<div class="section-title">구매영업관리</div>
		<a href="#">발주관리</a> <a href="#">주문관리</a> <a href="#">출고관리</a> <a
			href="#">자재소요량계산</a>
		<div class="section-title">자재관리</div>
		<a href="#">입고관리</a> <a href="#">재고관리</a>
		<div class="section-title">생산관리</div>
		<a href="#">생산계획</a>
	</div>

	<div class="top-bar">
		<button class="menu-icon" onclick="toggleSidebar()">&#9776;</button>
		<h3 class="fw-bold m-0">CodeA</h3>
		<div></div>
	</div>

	<div class="main-content" id="mainContent">
		<h4 class="fw-bold mb-3">발주목록</h4>

		<form method="get" th:action="@{/purchase}" class="d-flex gap-2 mb-3">
			<input type="text" name="keyword" class="form-control"
				placeholder="검색어" th:value="${params['keyword']}" />
            <select name="status" class="form-select">
                <option value="" th:selected="${params['status'] == null or params['status'] == ''}">전체</option>
                <option value="접수" th:selected="${params['status'] == '접수'}">접수</option>
                <option value="진행중" th:selected="${params['status'] == '진행중'}">진행중</option>
                <option value="완료" th:selected="${params['status'] == '완료'}">완료</option>
            </select>
            <input type="date" name="startDate" class="form-control"
				th:value="${params['startDate']}" /> <input type="date"
				name="endDate" class="form-control" th:value="${params['endDate']}" />

			<button type="submit" class="btn btn-primary">검색</button>
		</form>


		<div class="table-responsive">
			<table class="table table-bordered table-hover align-middle">
				<thead class="table-light">
					<tr>
						<th>발주코드</th>
						<th>발주일</th>
						<th class="text-start">공급처명</th>
						<th class="text-end">총 발주금액</th>
						<th>발주상태</th>
						<th>담당자명</th>
						<th>등록일</th>
						<th class="text-start">비고</th>
					</tr>
				</thead>
				<tbody>
					<tr th:if="${#lists.isEmpty(purchaseList)}">
                        <td colspan="8" class="text-center">조회된 발주 목록이 없습니다.</td>
                    </tr>
					<tr th:each="purchase : ${purchaseList}" th:if="${not #lists.isEmpty(purchaseList)}">
						<td><a href="#" class="purchase-code-link"
							th:attr="data-code=${purchase.purchaseCode}, data-id=${purchase.purchaseId}"
							th:text="${purchase.purchaseCode}"
							onclick="handleDetailClick(this); return false;"></a></td>
						<td th:text="${#dates.format(purchase.orderDate, 'yyyy-MM-dd')}"></td>
						<td class="text-start" th:text="${purchase.supplierName}"></td>
						<td class="text-end"
							th:text="${#numbers.formatInteger(purchase.totalAmount, 3, 'COMMA')}"></td>
						<td th:text="${purchase.status}"></td>
						<td th:text="${purchase.employeeName}"></td>
						<td th:text="${#dates.format(purchase.createdAt, 'yyyy-MM-dd')}"></td>
						<td class="text-start" th:text="${purchase.remark}"></td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="d-flex justify-content-between align-items-center mt-3" th:if="${totalPages > 0}">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" th:classappend="${!hasPreviousPageGroup} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/purchase(page=${previousPageGroupStart}, keyword=${params['keyword']}, status=${params['status']}, startDate=${params['startDate']}, endDate=${params['endDate']})}">&laquo;&laquo;</a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/purchase(page=${currentPage - 1}, keyword=${params['keyword']}, status=${params['status']}, startDate=${params['startDate']}, endDate=${params['endDate']})}">&laquo;</a>
                    </li>

                    <li class="page-item" th:each="pageNumber : ${#numbers.sequence(startPage, endPage)}"
                        th:classappend="${pageNumber == currentPage} ? 'active' : ''">
                        <a class="page-link" th:href="@{/purchase(page=${pageNumber}, keyword=${params['keyword']}, status=${params['status']}, startDate=${params['startDate']}, endDate=${params['endDate']})}"
                           th:text="${pageNumber}"></a>
                    </li>

                    <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/purchase(page=${currentPage + 1}, keyword=${params['keyword']}, status=${params['status']}, startDate=${params['startDate']}, endDate=${params['endDate']})}">&raquo;</a>
                    </li>
                     <li class="page-item" th:classappend="${!hasNextPageGroup} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/purchase(page=${nextPageGroupStart}, keyword=${params['keyword']}, status=${params['status']}, startDate=${params['startDate']}, endDate=${params['endDate']})}">&raquo;&raquo;</a>
                    </li>
                </ul>
            </nav>
            <div>
                <button class="btn btn-dark" onclick="goToPurchaseCreatePage()">발주 등록</button>
            </div>
        </div>
        <div class="d-flex justify-content-end align-items-center mt-3" th:if="${totalPages == 0}">
             <div>
                <button class="btn btn-dark" onclick="goToPurchaseCreatePage()">발주 등록</button>
            </div>
         </div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const content = document.getElementById('mainContent');
      sidebar.classList.toggle('active');
      content.classList.toggle('shifted');
    }

    function goToPurchaseCreatePage() {
      if (confirm('발주 등록 페이지로 이동 하시겠습니까?')) {
        // 실제 운영 환경에서는 아래 alert 대신 window.location.href 를 사용하세요.
         window.location.href = '/purchase/create'; // 예시 경로
        //alert('발주 등록 페이지로 이동합니다. (실제 이동 경로는 수정 필요)');
      }
    }

    function handleDetailClick(el) {
      const code = el.getAttribute('data-code');
      const id = el.getAttribute('data-id');
      viewPurchaseDetail(code, id);
    }

    function viewPurchaseDetail(purchaseCode, purchaseId) {
      // 실제 운영 환경에서는 아래 alert 대신 window.location.href 를 사용하세요.
       window.location.href = '/purchase/' + purchaseId; // 예시 경로
      //alert(purchaseCode + ' (ID: ' + purchaseId + ') 발주의 상세 페이지로 이동합니다. (실제 이동 경로는 수정 필요)');
    }
  </script>
</body>
</html>
