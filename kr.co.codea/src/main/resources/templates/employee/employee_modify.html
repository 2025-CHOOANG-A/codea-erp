<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>사원 등록 - CodeA</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        min-height: 100vh;
        background-color: #f8f9fa;
      }

      .main-content {
        margin-left: 250px;
        transition: margin-left 0.3s;
        padding: 2rem 1rem 1rem 1rem;
      }
      .sidebar.collapsed ~ .main-content {
        margin-left: 0;
      }
      @media (max-width: 991.98px) {
        .main-content {
          margin-left: 0;
        }
      }
      .profile-img-wrapper {
        position: relative;
        display: inline-block;
        margin-bottom: 1.5rem;
        margin-top: 1.5rem;
      }
      .profile-img-preview {
        width: 120px;
        height: 160px;
        object-fit: cover;
        border-radius: 0.5rem;
        border: 3px solid #e9ecef;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        display: block;
      }
      .profile-img-upload-btn {
        position: absolute;
        right: 8px;
        bottom: 8px;
        background: #fff;
        border: 2px solid #dee2e6;
        border-radius: 50%;
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        transition: background 0.2s, border 0.2s;
        z-index: 2;
      }
      .profile-img-upload-btn:hover {
        background: #f1f3f5;
        border-color: #adb5bd;
      }
      .profile-img-upload-btn input[type="file"] {
        display: none;
      }
      .profile-form-table th {
        width: 30%;
        background: #f8f9fa;
        color: #6c757d;
        font-weight: 500;
        vertical-align: middle;
      }
      .profile-form-table td {
        background: #fff;
        vertical-align: middle;
      }
      /* 중복확인 버튼 줄바꿈 방지 및 입력폼 길이 조정 */
      .form-check-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .form-check-group .form-control {
        min-width: 0;
        flex: 1 1 0;
        max-width: 220px;
      }
      .form-check-group .btn {
        white-space: nowrap;
        flex-shrink: 0;
      }
      @media (max-width: 575.98px) {
        .form-check-group .form-control {
          max-width: 120px;
        }
      }
      .pw-confirm-msg {
        font-size: 0.95em;
        color: #dc3545;
        margin-top: 0.25rem;
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->


    <!-- Main Content -->
    <main class="main-content">
      <div class="container" style="max-width: 600px">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-white border-bottom-0"></div>
          <h5 class="mb-0 fw-bold text-center mt-3">사원 등록</h5>
          <div class="card-body">
            <form
              id="employeeForm"
              enctype="multipart/form-data"
              autocomplete="off"
            >
              <div class="d-flex flex-column align-items-center mb-3">
                <div class="profile-img-wrapper">
                  <img
                    id="profileImgPreview"
                    src="https://i.pinimg.com/236x/2c/c0/41/2cc04135e9c5d94385144a567c35bf6c.jpg"
                    alt="프로필 이미지 미리보기"
                    class="profile-img-preview shadow-sm"
                  />
                  <label class="profile-img-upload-btn" title="사진 변경">
                    <input
                      type="file"
                      id="profileImg"
                      name="profileImg"
                      accept="image/*"
                      required
                    />
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="22"
                      height="22"
                      fill="#495057"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M10.5 2a.5.5 0 0 1 .5.5V3h1A2.5 2.5 0 0 1 14.5 5.5v6A2.5 2.5 0 0 1 12 14H4a2.5 2.5 0 0 1-2.5-2.5v-6A2.5 2.5 0 0 1 4 3h1v-.5a.5.5 0 0 1 1 0V3h4v-.5a.5.5 0 0 1 .5-.5zM4 4a1.5 1.5 0 0 0-1.5 1.5v6A1.5 1.5 0 0 0 4 13h8a1.5 1.5 0 0 0 1.5-1.5v-6A1.5 1.5 0 0 0 12 4H4zm4 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"
                      />
                    </svg>
                  </label>
                </div>
              </div>
              <table class="table table-bordered profile-form-table mb-0">
                <tbody>
                  <tr>
                    <th scope="row">
                      <label for="empName" class="form-label mb-0">이름</label>
                    </th>
                    <td>
                      <input
                        type="text"
                        class="form-control"
                        id="empName"
                        name="empName"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label class="form-label mb-0">사원번호</label>
                    </th>
                    <td>
                      <input
                        type="text"
                        class="form-control"
                        id="empNo"
                        name="empNo"
                        value="자동부여"
                        readonly
                        tabindex="-1"
                        style="background: #e9ecef"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="department" class="form-label mb-0"
                        >부서</label
                      >
                    </th>
                    <td>
                      <select
                        class="form-select"
                        id="department"
                        name="department"
                        required
                      >
                        <option value="" selected disabled>선택</option>
                        <option value="영업부">영업부</option>
                        <option value="생산부">생산부</option>
                        <option value="구매부">구매부</option>
                        <option value="자재부">자재부</option>
                        <option value="관리부">관리부</option>
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="position" class="form-label mb-0">직책</label>
                    </th>
                    <td>
                      <select
                        class="form-select"
                        id="position"
                        name="position"
                        required
                      >
                        <option value="" selected disabled>선택</option>
                        <option value="사원">사원</option>
                        <option value="주임">주임</option>
                        <option value="대리">대리</option>
                        <option value="과장">과장</option>
                        <option value="차장">차장</option>
                        <option value="부장">부장</option>
                        <option value="이사">이사</option>
                        <option value="부사장">부사장</option>
                        <option value="사장">사장</option>
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="email" class="form-label mb-0">이메일</label>
                    </th>
                    <td>
                      <div class="form-check-group">
                        <input
                          type="email"
                          class="form-control"
                          id="email"
                          name="email"
                          required
                        />
                        <button
                          type="button"
                          class="btn btn-outline-secondary btn-sm"
                          id="emailCheckBtn"
                        >
                          중복확인
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="extNo" class="form-label mb-0"
                        >내선번호</label
                      >
                    </th>
                    <td>
                      <div class="form-check-group">
                        <input
                          type="text"
                          class="form-control"
                          id="extNo"
                          name="extNo"
                          required
                        />
                        <button
                          type="button"
                          class="btn btn-outline-secondary btn-sm"
                          id="extNoCheckBtn"
                        >
                          중복확인
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="phone" class="form-label mb-0"
                        >전화번호</label
                      >
                    </th>
                    <td>
                      <input
                        type="text"
                        class="form-control"
                        id="phone"
                        name="phone"
                        required
                      />
                    </td>
                  </tr>
                </tbody>
                <tbody id="adminFields" style="display: none">
                  <tr>
                    <th scope="row">
                      <label for="userId" class="form-label mb-0">아이디</label>
                    </th>
                    <td>
                      <input
                        type="text"
                        class="form-control"
                        id="userId"
                        name="userId"
                        autocomplete="username"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="userPw" class="form-label mb-0"
                        >비밀번호</label
                      >
                    </th>
                    <td>
                      <input
                        type="password"
                        class="form-control"
                        id="userPw"
                        name="userPw"
                        autocomplete="new-password"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <label for="userPwConfirm" class="form-label mb-0"
                        >비밀번호 확인</label
                      >
                    </th>
                    <td>
                      <div class="form-check-group">
                        <input
                          type="password"
                          class="form-control"
                          id="userPwConfirm"
                          name="userPwConfirm"
                          autocomplete="new-password"
                          required
                        />
                        <button
                          type="button"
                          class="btn btn-outline-secondary btn-sm"
                          id="pwConfirmCheckBtn"
                        >
                          중복확인
                        </button>
                      </div>
                      <div id="pwConfirmMsg" class="pw-confirm-msg">
                        비밀번호가 일치하지 않습니다.
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="d-flex justify-content-end gap-2 mt-3">
                <button type="submit" class="btn btn-primary">저장</button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="window.history.back();"
                >
                  취소
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>

    <script>
      // 프로필 이미지 미리보기
      document
        .getElementById("profileImg")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (ev) {
              document.getElementById("profileImgPreview").src =
                ev.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      // 중복확인(이메일/내선번호) - 예시
      document
        .getElementById("emailCheckBtn")
        .addEventListener("click", function () {
          const email = document.getElementById("email").value.trim();
          if (!email) {
            alert("이메일을 입력하세요.");
            document.getElementById("email").focus();
            return;
          }
          // 실제 중복확인 로직 필요
          alert("이메일 사용 가능합니다.");
        });
      document
        .getElementById("extNoCheckBtn")
        .addEventListener("click", function () {
          const extNo = document.getElementById("extNo").value.trim();
          if (!extNo) {
            alert("내선번호를 입력하세요.");
            document.getElementById("extNo").focus();
            return;
          }
          // 실제 중복확인 로직 필요
          alert("내선번호 사용 가능합니다.");
        });

      // 관리자 여부에 따라 아이디/비밀번호 입력폼 표시 (예시: 실제는 서버에서 권한 체크)
      // 아래 isAdmin 값을 실제 로그인/권한에 따라 동적으로 설정
      const isAdmin = true; // 관리자면 true, 아니면 false
      if (isAdmin) {
        document.getElementById("adminFields").style.display = "";
        document.getElementById("userId").required = true;
        document.getElementById("userPw").required = true;
        document.getElementById("userPwConfirm").required = true;
      }

      // 비밀번호 확인 체크
      function checkPwMatch() {
        const pw = document.getElementById("userPw").value;
        const pwConfirm = document.getElementById("userPwConfirm").value;
        const msg = document.getElementById("pwConfirmMsg");
        if (pw && pwConfirm && pw !== pwConfirm) {
          msg.style.display = "block";
          return false;
        } else {
          msg.style.display = "none";
          return true;
        }
      }
      document.getElementById("userPw").addEventListener("input", checkPwMatch);
      document
        .getElementById("userPwConfirm")
        .addEventListener("input", checkPwMatch);

      // 비밀번호 확인 중복확인 버튼
      document
        .getElementById("pwConfirmCheckBtn")
        .addEventListener("click", function () {
          const pw = document.getElementById("userPw").value;
          const pwConfirm = document.getElementById("userPwConfirm").value;
          if (!pw || !pwConfirm) {
            alert("비밀번호와 비밀번호 확인을 모두 입력하세요.");
            return;
          }
          if (pw !== pwConfirm) {
            alert("비밀번호가 일치하지 않습니다.");
          } else {
            alert("비밀번호가 일치합니다.");
          }
        });

      // 폼 제출 예시 (실제 저장 로직은 서버 연동 필요)
      document
        .getElementById("employeeForm")
        .addEventListener("submit", function (e) {
          // 관리자일 때만 비밀번호 확인 체크
          if (isAdmin) {
            if (!checkPwMatch()) {
              document.getElementById("userPwConfirm").focus();
              e.preventDefault();
              return false;
            }
          }
          e.preventDefault();
          alert("저장되었습니다.");
          // 실제 저장 로직은 서버와 연동 필요
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
