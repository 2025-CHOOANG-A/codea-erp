<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>사원 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
    <style>
        body {
            background: #f8f9fa;
            /* 헤더가 fixed이므로 body 상단에 헤더 높이만큼 패딩을 주지 않으면 내용이 가려질 수 있습니다.
               만약 fragments/sidebar.html 내부에 body padding-top이 이미 있다면 중복될 수 있으니 확인 필요합니다.
               여기서는 이 파일이 독립적으로 body를 갖는다고 가정하고 추가합니다. */
            padding-top: 64px;
        }

        .layout-wrapper { /* 이 클래스는 sidebar.html fragment 내에 있어야 합니다. */
            display: flex;
            flex-direction: row;
        }

        .main-content {
            /* body에 padding-top을 주었으므로, main-content의 margin-top은 제거하거나 조정합니다. */
            /* margin-top: 64px; */
            padding: 2rem;
            min-width: 1000px; /* 최소 너비는 상황에 맞게 조정 */
            margin-left: 0; /* 사이드바 닫혔을 때 기본 마진 */
            transition: margin-left 0.3s;
            flex: 1; /* 남은 공간을 채우도록 설정 */
            width: 100%; /* 초기 너비 설정 */
        }

        /* 사이드바가 보이는 상태일 때 main-content의 왼쪽 마진 조정 */
        /* 이 클래스는 body 또는 layout-wrapper에 동적으로 추가/제거되어야 합니다. */
        body.sidebar-visible .main-content, /* 또는 #layoutWrapper.sidebar-visible .main-content */
        .layout-wrapper.sidebar-visible .main-content {
            margin-left: 260px; /* 사이드바 너비만큼 */
        }
        @media (max-width: 991.98px) {
            body.sidebar-visible .main-content,
            .layout-wrapper.sidebar-visible .main-content {
                margin-left: 220px; /* 작은 화면에서 사이드바 너비 */
            }
        }
        /* 테이블 스타일은 기존 CSS를 활용하거나 필요시 여기에 추가 */
    </style>
</head>
<body>
    <div class="layout-wrapper" id="layoutWrapper"> <div th:replace="~{fragments/sidebar :: layout}"></div>

        <main id="mainContent" class="main-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 th:text="${pageTitle ?: '사원 목록'}">사원 목록</h2>
                <a th:href="@{/employee/new}" class="btn btn-primary">신규 사원 등록</a> </div>

            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>사번</th>
                            <th>이름</th>
                            <th>부서</th>
                            <th>직책</th>
                            <th>이메일</th>
                            <th>내선번호</th>
                            <th>작업</th> </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${employees != null and !employees.isEmpty()}" th:each="employee : ${employees}">
                            <td th:text="${employee.empNo}">1001</td>
                            <td>
                                <a th:href="@{/employee/{empId}(empId=${employee.empId})}" th:text="${employee.empName}" class="name-link">김민수</a>
                            </td>
                            <td th:text="${employee.empDept}">영업부</td>
                            <td th:text="${employee.empPosition}">과장</td>
                            <td th:text="${employee.email}">minsu.kim@company.com</td>
                            <td th:text="${employee.tel}">0101</td>
                            <td>
                                <a th:href="@{/employee/{empId}/edit(empId=${employee.empId})}" class="btn btn-sm btn-outline-primary me-1">수정</a>
                                <form th:action="@{/employee/{empId}/delete(empId=${employee.empId})}" method="post" style="display: inline;" onsubmit="return confirm('정말로 이 사원을 삭제하시겠습니까?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">삭제</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${employees == null or employees.isEmpty()}">
                            <td colspan="7">등록된 사원이 없습니다.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            </main>
    </div>

    <script th:if="${#strings.isEmpty(#httpServletRequest.getAttribute('sidebarJsIncluded'))}">
        const sidebar = document.getElementById("sidebar");
        const sidebarToggle = document.getElementById("sidebarToggle");
        const sidebarClose = document.getElementById("sidebarClose");
        const layoutWrapper = document.getElementById("layoutWrapper"); // 또는 body
        const mainContent = document.getElementById("mainContent");


        if (sidebarToggle && sidebar && sidebarClose && layoutWrapper && mainContent) {
            sidebarToggle.addEventListener("click", () => {
                sidebar.classList.add("show");
                // body 또는 layoutWrapper에 클래스를 추가하여 main-content의 마진을 조절
                // 여기서는 body에 추가한다고 가정. CSS도 body.sidebar-visible 기준으로 수정 필요
                document.body.classList.add("sidebar-visible");
            });

            sidebarClose.addEventListener("click", () => {
                sidebar.classList.remove("show");
                document.body.classList.remove("sidebar-visible");
            });

            document.addEventListener("click", (e) => {
                if (
                    sidebar.classList.contains("show") &&
                    !sidebar.contains(e.target) &&
                    !sidebarToggle.contains(e.target)
                ) {
                    sidebar.classList.remove("show");
                    document.body.classList.remove("sidebar-visible");
                }
            });
        } else {
            if (!sidebar) console.warn("Element with ID 'sidebar' not found.");
            if (!sidebarToggle) console.warn("Element with ID 'sidebarToggle' not found.");
            if (!sidebarClose) console.warn("Element with ID 'sidebarClose' not found.");
            if (!layoutWrapper) console.warn("Element with ID 'layoutWrapper' not found.");
            if (!mainContent) console.warn("Element with ID 'mainContent' not found.");
        }
        // 공통 스크립트가 sidebar fragment에 포함되어 있다면, 중복 실행 방지 플래그 설정
        // 예: th:with="sidebarJsIncluded=true" 를 sidebar fragment 최상단에 추가
    </script>
    </body>
</html>