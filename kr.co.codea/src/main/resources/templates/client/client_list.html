<div th:fragment="contentFragment">

<th:block th:fragment="headFragment">
    <link rel="stylesheet" th:href="@{/css/client_list.css}" />
</th:block>
    
    <main id="mainContent" class="main-content">
      <div class="container-fluid px-0">
        <h2>거래처 목록</h2> 
        <form class="filter-bar mb-3" id="filterForm" autocomplete="off" onsubmit="return false;">
          <select class="form-select" id="typeFilter">
            <option value="전체">거래처유형 전체</option>
            <option value="고객사">고객사</option>
            <option value="구매처">구매처</option>
            <option value="매입매출처">매입매출처</option>
          </select>
          <input type="text" class="form-control" id="searchInput" placeholder="코드, 거래처명 등 검색" />
          <button type="button" class="btn btn-primary" id="searchBtn">
            검색
          </button>
        </form>

        <div class="table-responsive">
          <table
            class="table table-bordered align-middle mb-0"
            id="clientTable" >
            <thead>
              <tr>
                <th style="width:60px;">no</th> <th>코드</th>
                <th>거래처명</th>
                <th>유형</th>
                <th>사업자번호</th>
                <th>전화</th>
                <th>주소</th>
                <th style="width:100px;">비고</th> </tr>
            </thead>
					<tbody id="clientTableBody">
				  <tr th:if="${clients.isEmpty()}" id="noDataRow">
				      <td colspan="8" class="text-center text-secondary">데이터가 없습니다.</td>
				  </tr>
				  <th:block th:unless="${clients.isEmpty()}">
				    <tr th:each="client, i : ${clients}">
				      <td th:text="${i.size - i.index}"></td>
				      <td th:text="${client.bpCode}"></td>
				      <td>
				        <a th:href="@{'/client/' + ${client.bpId}}" class="name-link" th:text="${client.bpName}"></a>
				      </td>
				      <td th:text="${client.bpType}"></td>
				      <td th:text="${client.bizNo}"></td>
				      <td th:text="${client.bp_tel}"></td>
				      <td th:text="${client.address}"></td>
				      <td>
				          <span th:unless="${client.bp_remark}">-</span>
				          <button type="button" class="btn btn-outline-secondary btn-sm btn-remark"
				                  th:if="${client.bp_remark}" th:data-remark="${client.bp_remark}" th:text="내용 확인"></button>
				      </td>
				    </tr>
				  </th:block>
				</tbody>

          </table>
        </div>

        <div class="table-footer mt-3">
          <a href="./client/write" class="btn btn-success" id="addBtn">추가</a>
        </div>
      </div>
    </main>

    <div
      class="modal fade"
      id="remarkModal"
      tabindex="-1"
      aria-labelledby="remarkModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="remarkModalLabel">비고 내용</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="닫기"
            ></button>
          </div>
          <div class="modal-body" id="remarkModalBody">
            </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    
      document.addEventListener("mousedown", function (e) {
        if (
          window.innerWidth < 992 &&
          !sidebar.classList.contains("closed") &&
          !sidebar.contains(e.target) &&
          !sidebarOpenBtn.contains(e.target)
        ) {
          closeSidebar();
        }
      });

      function handleSidebarState() {
        if (window.innerWidth >= 992) {
          openSidebar(); // Open sidebar on larger screens
        } else {
          closeSidebar(); // Close sidebar on smaller screens
        }
      }
      
      window.addEventListener("resize", handleSidebarState);
       document.addEventListener("DOMContentLoaded", handleSidebarState);
      document
        .getElementById("clientTableBody")
        .addEventListener("click", function (e) {
          if (e.target.classList.contains("btn-remark")) {
            const remark = e.target.getAttribute("data-remark");
            document.getElementById("remarkModalBody").textContent = remark;
            const modal = new bootstrap.Modal(
              document.getElementById("remarkModal")
            );
            modal.show();
          }
           if (e.target.classList.contains("name-link")) {
             console.log("거래처명 링크 클릭:", e.target.textContent);
             console.log("이동할 URL:", e.target.href);
           }
        });

    </script>
</div>
