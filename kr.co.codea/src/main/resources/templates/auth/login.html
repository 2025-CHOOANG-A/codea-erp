<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CodeA | 물류 · 생산 관리 ERP 시스템</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        min-height: 100vh;
        background-color: #f8f9fa;
      }
      .header {
        background: #212529;
        color: #fff;
        padding: 1rem 2rem;
      }
      .login-container {
        min-height: 100vh; /* 헤더 높이를 고려하여 조정하거나, body에서 헤더 높이만큼 padding-top을 줄 수 있습니다. */
        display: flex;
        align-items: center;
        justify-content: center;
        padding-top: 70px; /* 예시: 헤더 높이만큼 패딩 추가 */
        box-sizing: border-box;
      }
      .login-card {
        width: 100%;
        max-width: 400px;
        padding: 2rem 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.05);
        background: #fff;
      }
      .login-links {
        display: flex;
        justify-content: space-between;
        font-size: 0.95rem;
      }
      .login-link {
        color: #212529;
        text-decoration: none;
        background: none;
        border: none;
        padding: 0;
        font-weight: 400;
      }
      .login-link:hover,
      .login-link:focus {
        text-decoration: underline;
        color: #0d6efd;
      }
      /* 메시지 표시를 위한 스타일 추가 */
      .message {
        margin-top: 1rem;
        font-size: 0.9rem;
      }
      .message.success {
        color: green;
      }
      .message.error {
        color: red;
      }
    </style>
  </head>
  <body>
    <header class="header d-flex align-items-center fixed-top"> <h1 class="h4 mb-0 fw-bold">
        CodeA
        <small class="fw-normal" style="font-size: 1rem"
          >물류 · 생산 관리 ERP 시스템</small
        >
      </h1>
    </header>

    <main class="login-container">
      <div class="login-card shadow-sm">
        <h2 class="mb-4 text-center fw-bold">로그인</h2>
        <form id="loginForm">
          <div class="mb-3">
            <label for="loginIdInput" class="form-label">아이디</label> <input
              type="text"
              class="form-control"
              id="loginIdInput" placeholder="아이디를 입력하세요"
              required
            />
          </div>
          <div class="mb-3">
            <label for="passwordInput" class="form-label">비밀번호</label> <input
              type="password"
              class="form-control"
              id="passwordInput" placeholder="비밀번호를 입력하세요"
              required
            />
          </div>
          <div class="d-grid mb-3">
            <button type="submit" class="btn btn-primary">로그인</button>
          </div>
          <div class="login-links mb-2">
            <button type="button" class="login-link" id="findIdBtn">
              아이디 찾기
            </button>
            <button type="button" class="login-link" id="findPwBtn">
              비밀번호 찾기
            </button>
          </div>
        </form>
        <div id="loginMessage" class="message text-center"></div> </div>
    </main>

    <script>
      // 로그인 폼 제출 이벤트
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault(); // 폼의 기본 제출 동작 방지

          const loginId = document.getElementById("loginIdInput").value; // 변경된 ID 사용
          const password = document.getElementById("passwordInput").value; // 변경된 ID 사용
          const loginMessageDiv = document.getElementById("loginMessage");
          loginMessageDiv.textContent = ''; // 이전 메시지 초기화
          loginMessageDiv.className = 'message text-center'; // CSS 클래스 초기화

          // 서버로 보낼 데이터 객체 생성 (LoginRequestDto와 필드명 일치)
          const loginData = {
            loginId: loginId, // 서버 DTO의 필드명과 일치해야 함
            password: password
          };

          try {
            // 서버의 /auth/login API로 POST 요청
            const response = await fetch('/auth/login', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(loginData) // 데이터를 JSON 문자열로 변환
            });

            if (response.ok) { // HTTP 상태 코드가 200-299 범위일 때
              const tokenDto = await response.json(); // 응답 바디를 JSON으로 파싱

              // 토큰 저장 (보안상 localStorage보다는 HttpOnly 쿠키 + CSRF 방어 또는 적절한 상태관리 라이브러리 사용 권장)
              // 여기서는 간단히 localStorage 사용 예시
              localStorage.setItem('accessToken', tokenDto.accessToken);
              localStorage.setItem('refreshToken', tokenDto.refreshToken);

              loginMessageDiv.textContent = '로그인 성공! 잠시 후 메인 페이지로 이동합니다.';
              loginMessageDiv.classList.add('success');

              // 로그인 성공 후 이동할 페이지 (예: /index 또는 /home)
              // '/index'가 HomeController에 매핑된 경로라고 가정
              setTimeout(() => {
                window.location.href = '/index';
              }, 1000); // 1초 후 이동

            } else {
              // 로그인 실패 처리 (서버에서 오류 메시지를 JSON으로 보낸다고 가정)
              let errorMessage = '로그인에 실패했습니다.';
              try {
                  const errorData = await response.json();
                  if (errorData && errorData.message) {
                      errorMessage = errorData.message;
                  } else {
                      errorMessage = `오류 상태: ${response.status} (${response.statusText})`;
                  }
              } catch (e) {
                  // 응답이 JSON이 아니거나 파싱 실패 시
                  errorMessage = `오류 상태: ${response.status} (${response.statusText})`;
              }
              loginMessageDiv.textContent = errorMessage;
              loginMessageDiv.classList.add('error');
            }
          } catch (error) {
            // 네트워크 오류 등 fetch 자체의 실패
            console.error('로그인 요청 중 오류 발생:', error);
            loginMessageDiv.textContent = '로그인 요청 중 오류가 발생했습니다. 네트워크 연결을 확인해주세요.';
            loginMessageDiv.classList.add('error');
          }
        });

      document
        .getElementById("findIdBtn")
        .addEventListener("click", function () {
          alert("아이디 찾기 기능은 준비 중입니다.");
        });

      document
        .getElementById("findPwBtn")
        .addEventListener("click", function () {
          alert("비밀번호 찾기 기능은 준비 중입니다.");
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>