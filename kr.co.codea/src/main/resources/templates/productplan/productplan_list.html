<div th:fragment="contentFragment">

<th:block th:fragment="headFragment">
    <link rel="stylesheet" th:href="@{/css/storage_list.css}" />
    </th:block>

    <main class="content">
      <div class="container">
        <h2 class="mb-4">생산 계획 조회</h2>
        <form id="filterForm" class="filter-bar flex flex-wrap items-center gap-3 mb-4 p-3 border rounded-md shadow-sm bg-white">
                              <div class="flex items-center gap-2">
                     <label for="startDate" class="text-sm text-gray-700 whitespace-nowrap">검색:</label>
         
          <input
            type="text"
            name="keyword"
            id="planKeywordInput"
            class="form-control flex-grow"
            placeholder="계획 번호, 품목 이름 검색"
            maxlength="20"
            th:value="${searchDto.keyword}"
          />
          </div>

          <div class="flex items-center gap-2">
            <label for="startDate" class="text-sm text-gray-700 whitespace-nowrap">계획 시작일:</label>
            <input
              type="date"
              name="startDate"
              id="startDate"
              class="form-control"
              th:value="${searchDto.startDate}"
            />
          </div>
          <div class="flex items-center gap-2">
            <label for="endDate" class="text-sm text-gray-700 whitespace-nowrap">계획 완료일:</label>
            <input
              type="date"
              name="endDate"
              id="endDate"
              class="form-control"
              th:value="${searchDto.endDate}"
            />
          </div>

          <div class="flex items-center gap-2">
            <label for="status" class="text-sm text-gray-700 whitespace-nowrap">상태:</label>
            <select name="status" id="status" class="form-select" th:value="${searchDto.status}">
              <option value="">전체</option>
              <option value="PLANNED" th:selected="${searchDto.status == 'PLANNED'}">계획</option>
              <option value="IN_PROGRESS" th:selected="${searchDto.status == 'IN_PROGRESS'}">진행중</option>
              <option value="COMPLETED" th:selected="${searchDto.status == 'COMPLETED'}">완료</option>
              <option value="CANCELLED" th:selected="${searchDto.status == 'CANCELLED'}">취소</option>
            </select>
          </div>

          <div class="flex items-center gap-2">
            <label for="empNo" class="text-sm text-gray-700 whitespace-nowrap">담당자 사번:</label>
            <input
              type="text"
              name="empNo"
              id="empNo"
              class="form-control"
              placeholder="사번"
              maxlength="10"
              th:value="${searchDto.empNo}"
            />
          </div>

          <button id="searchBtn" type="submit" class="btn btn-primary ml-auto">검색</button>
        </form>

        <div class="table-responsive">
          <table
            id="productionPlanTable"
            class="table table-hover align-middle mb-0"
          >
            <thead class="table-light">
              <tr>
                <th scope="col" class="text-center">
                    <input type="checkbox" id="selectAllCheckboxes" class="form-check-input">
                </th>
             	 <th scope="col">NO</th>
                <th scope="col">생산계획 번호</th>
                <th scope="col">품목 코드</th>
                <th scope="col">품목 이름</th>
                <th scope="col">생산계획시작일</th>
                <th scope="col">생산완료계획일</th>
                <th scope="col">실제 완료일</th>
                <th scope="col">생산계획수량</th>
                <th scope="col">실제 수량</th>
                <th scope="col">상태</th>
                <th scope="col">담당자 사번</th>
                <th scope="col">비고</th>
              </tr>
            </thead>
            <tbody>
           	<tr th:if="${productionPlans.isEmpty()}" id="noDataRow">
			 <td colspan="13" class="text-center text-secondary">데이터가 없습니다.</td> </tr>
           	<th:block th:unless="${productionPlans.isEmpty()}">
				<tr th:each="plan, i : ${productionPlans}">
				<td class="text-center">
                    <input type="checkbox" class="row-checkbox form-check-input" th:data-plan-id="${plan.planId}">
                </td>
				<td th:text="${i.size - i.index}"></td>
				<td th:text="${plan.planId}"></td>
				<td th:text="${plan.itemCode}"></td>
				<td th:text="${plan.itemName}"></td>
				<td th:text="${plan.startDate}"></td>
				<td th:text="${plan.dueDate}"></td>
				<td th:text="${plan.completionDate ?: '-'}"></td>
                <td th:text="${plan.planQty}"></td>
				<td th:text="${plan.actualQty}"></td>
				<td th:text="${plan.status}"></td>
				<td th:text="${plan.empNo}"></td>
				<td>
				    <button type="button" class="btn btn-outline-secondary btn-sm remark-btn"
				     th:data-remark="${plan.remark}"
				     th:text="${plan.remark != null and !plan.remark.isEmpty() ? '비고 보기' : '-'}">
				    </button>
				</td>
			</tr>
			</th:block>
            </tbody>
          </table>
        </div>

        <div class="table-footer-row flex justify-between items-center mt-4">
          <nav>
            <ul id="pagination" class="pagination justify-content-center mb-0">
              </ul>
          </nav>
          <div class="flex gap-2">
            <a th:href="@{/productionplan/write}" class="btn btn-success add-btn">등록</a>
            <button type="button" class="btn btn-outline-danger delete-btn">
              선택 삭제
            </button>
          </div>
        </div>
      </div>
    </main>

    <div
      class="modal fade"
      id="remarkModal"
      tabindex="-1"
      aria-labelledby="remarkModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="remarkModalLabel">비고 내용</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="닫기"
            ></button>
          </div>
          <div class="modal-body">
            <p id="remarkContent"></p>
          </div>
        </div>
      </div>
    </div>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   <script th:src="@{/js/production_plan_list.js}"></script>
</div>
